<!doctype html>
<html class="no-js" lang="">
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<title></title>
		<meta name="description" content="">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<script src="/socket.io/socket.io.js"></script>
		<link rel="stylesheet" href="css/normalize.min.css">
		<link rel="stylesheet" href="css/main.css">
		<script src="js/three.min.js"></script>
		<script src="js/TrackballControls.js"></script>
		<script src="js/threex.dynamictexture.js"></script>
		<script src="js/main.js"></script>
		<style media="screen">
			#media-video {
				display: none;
			}
		</style>
	</head>
	<body>
		<!--[if lt IE 8]>
		<p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
		<![endif]-->
		<input id="invertbtn" value="invert" type="button">
		<div id="promap">
			<video id='media-video'>
          <source src='img/sea.mp4' type='video/mp4'>
       </video>
			 <div class="controls">
			 	<button type="button" id="button-video" name="button-controls">Play/Pause</button>
			 </div>
			 <canvas id="canvas-video" width="300" height="300"></canvas>
			 <div id="tester">

			 </div>
		</div>

		<script type="text/javascript">
		var mediaPlayer = document.getElementById('media-video');
		var canvas = document.getElementById('canvas-video');
		var button = document.getElementById('button-video');
		button.addEventListener('click', function() {
			mediaPlayer.play();
		}, false);
		var ctx = canvas.getContext('2d');
		mediaPlayer.addEventListener('play', function() {
			//draw(this, ctx, 300, 300);
		}, false);
		function draw(vid, ctx, w, h) {
			(function loop() {

			})();
		}

			//app = new ProMap('promap');

			function animation() {
        requestAnimationFrame(animation);
				if (!mediaPlayer.paused && !mediaPlayer.ended) {
					ctx.drawImage(mediaPlayer, 0, 0, 300, 300);
		    	const imgdata = ctx.getImageData(0, 0, 300, 300);
					const data = new Uint32Array(imgdata.data.buffer);
					for (var i = 0; i < data.length; i += 1) {
						//data[i] = (0xFF000000 & data[i]) | (0x00FFFFFF & (~ data[i]));
						data[i] = ((dataMask[i]) << 24) | (0x00FFFFFF & (~ data[i]));
					}
					ctx.putImageData(imgdata, 0, 0);
				}
        //app.render()
      }
			/*var invertbtn = document.getElementById('invertbtn');
			invertbtn.addEventListener('click', function () {
				app.invert();
			});*/
			var mask = document.createElement('img');
			mask.src = 'img/snake.jpg';
			var dataMask = null;
			mask.onload = function() {
				var canvasMask = document.createElement('canvas');
				canvasMask.width = 300;
				canvasMask.height = 300;
				var tester = document.getElementById('tester');
				tester.appendChild(canvasMask);
				var ctxMask = canvasMask.getContext('2d');
				ctxMask.drawImage(mask, 0, 0, 300, 300);
				var imgdataMask = ctxMask.getImageData(0, 0, 300, 300);
				dataMaskBuffer = new Uint32Array(imgdataMask.data.buffer);
				dataMask = new Uint8Array(300 * 300);
				for (var i = 0; i < dataMaskBuffer.length; i += 1) {
					dataMask[i] = dataMaskBuffer[i] >> 8;
				}
      	animation();
			}
		</script>
	</body>
</html>
